(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{1:function(e,t,n){"use strict";n.r(t);var r=n(29),a=n(17),i=n.n(a),o=n(10),s=(n(48),n(45));n(46);window.memory=o.s;var c=n(65),u=n(66),l=function(e){var t,n=e.canvas,r=e.universe,a=e.isSnapshot,i=void 0!==a&&a,l=e.gl,d=(t=s(l?{gl:l,attributes:{preserveDrawingBuffer:i}}:{canvas:n,attributes:{preserveDrawingBuffer:i}})).texture(),f=r.width(),p=r.height(),h=r.cells(),v=new Uint8Array(o.s.buffer,h,f*p*4),m=t.texture({width:f,height:p,data:v}),y=t({blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1},equation:{rgb:"add",alpha:"add"},color:[0,0,0,0]},frag:c,uniforms:{t:function(e){return e.tick},dataTexture:function(){return h=r.cells(),v=new Uint8Array(o.s.buffer,h,f*p*4),m({width:f,height:p,data:v})},resolution:function(e){return[e.viewportWidth,e.viewportHeight]},dpi:(window.ratio||4)/4,isSnapshot:i,backBuffer:d},vert:u,attributes:{position:[[-1,4],[-1,-1],[4,-1]]},count:3});return{regl:t,draw:function(){t.poll(),y()}}},d=n(8),f=n.n(d),p=n(9),h=n.n(p),v=new(function(){function e(){f()(this,e),this.fps=document.getElementById("fps"),this.frames=[],this.lastFrameTimeStamp=performance.now()}return h()(e,[{key:"render",value:function(){var e=performance.now(),t=e-this.lastFrameTimeStamp;this.lastFrameTimeStamp=e;var n=1/t*1e3;this.frames.push(n),this.frames.length>15&&this.frames.shift();for(var r=1/0,a=-1/0,i=0,o=0;o<this.frames.length;o++)i+=this.frames[o],r=Math.min(this.frames[o],r),a=Math.max(this.frames[o],a);var s=i/this.frames.length;this.fps.textContent="FPS:".concat(Math.round(s).toString().padStart(3))}}]),e}()),m=n(67),y=n.n(m),x=document.getElementById("sand-canvas");var w=function(e,t){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2),2)},g=function(e){var t=function(e){return Math.sqrt(Math.pow(e.clientX,2)+Math.pow(e.clientY,2),2)}(e);return{clientX:e.clientX/t,clientY:e.clientY/t}},b=function(e,t){return{clientX:e.clientX*t,clientY:e.clientY*t}},E=function(e,t){return{clientX:e.clientX+t.clientX,clientY:e.clientY+t.clientY}},k=function(e,t){return{clientX:e.clientX-t.clientX,clientY:e.clientY-t.clientY}},_=!1,M=null,S=null;function C(e){clearInterval(S),S=window.setInterval((function(){return z(e)}),100);var t={clientX:e.clientX,clientY:e.clientY};if(_){var n=0;if(z(t),M)for(;w(t,M)>1/3;){var r=w(t,M);if(t=E(t,b(g(k(M,e)),Math.min(1/3,r))),++n>1e3)break;z(t)}M=e}}x.addEventListener("mousedown",(function(e){e.preventDefault(),_e.push_undo(),_=!0,clearInterval(S),S=window.setInterval((function(){return z(e)}),100),z(e),M=e})),document.body.addEventListener("mouseup",(function(e){clearInterval(S),_&&(e.preventDefault(),M=null,_=!1)})),x.addEventListener("mousemove",(function(e){clearInterval(S),C(e)})),x.addEventListener("mouseleave",(function(e){clearInterval(S),M=null})),x.addEventListener("touchstart",(function(e){e.cancelable&&e.preventDefault();Array.from(e.touches);_e.push_undo(),_=!0,M=e,D(e)})),x.addEventListener("touchend",(function(e){e.cancelable&&e.preventDefault(),M=null,_=!1,clearInterval(S)})),x.addEventListener("touchmove",(function(e){window.paused||e.cancelable&&e.preventDefault(),clearInterval(S),D(e)}));var D=function(e){var t=Array.from(e.touches);1==t.length?C(t[0]):t.forEach(z)};var z=function(e){if(_){var t=function(e){var t=x.getBoundingClientRect();t={left:t.left+28,top:t.top+28,width:t.width-56,height:t.height-56};var n=x.width/(be*Math.ceil(window.devicePixelRatio))/t.width,r=x.height/(be*Math.ceil(window.devicePixelRatio))/t.height,a=(e.clientX-t.left)*n,i=(e.clientY-t.top)*r;return[Math.min(Math.floor(a),Ee-1),Math.min(Math.floor(i),ke-1)]}(e),n=y()(t,2),r=n[0],a=n[1];if(!(window.UI.state.selectedElement<0)){_e.paint(r,a,1,window.UI.state.selectedElement)}}},R=(n(71),n(72)),I=n.n(R),A=n(74),L=n.n(A);function N(e){return new Promise((function(t){return setTimeout(t,e)}))}function T(e,t){return U.apply(this,arguments)}function U(){return(U=L()(I.a.mark((function e(t,n){var a,i,o,s,c,u,l;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=0;case 1:if(!(a<=1.7*t)){e.next=15;break}i=6;case 3:if(!(i>=1)){e.next=12;break}return o=a-12*i,universe.paint(t/2,n/2,o+5,r.d.Empty),universe.paint(t/2,n/2,o,i),e.next=9,N(16);case 9:i-=1,e.next=3;break;case 12:a+=72,e.next=1;break;case 15:s=0;case 16:if(!(s<=t-2)){e.next=23;break}return universe.paint(t/2,n/2,s-5,r.d.Empty),e.next=20,N(8);case 20:s+=16,e.next=16;break;case 23:c=0;case 24:if(!(c<=180)){e.next=34;break}return u=(t/2+10)*Math.cos(c*(Math.PI/180)),l=(n/2+10)*Math.sin(c*(Math.PI/180)),universe.paint(t/2+u,n/2+l,21,r.d.Empty),universe.paint(t/2-u,n/2-l,21,r.d.Empty),e.next=31,N(8);case 31:c+=7,e.next=24;break;case 34:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P,q=n(13),O=n.n(q),j=n(14),Y=n.n(j),B=n(15),F=n.n(B),G=n(2),W=n.n(G),X=n(77),H=n.n(X),K=n(24),Q=n(28),J=function(){return W.a.createElement("div",{className:"welcome-scrim"},W.a.createElement("div",{className:"Info window"},W.a.createElement("div",{className:"title-bar"},W.a.createElement("div",{className:"title-bar-text"},"Information"),W.a.createElement("div",{className:"title-bar-controls"},W.a.createElement(K.b,{to:"/"},W.a.createElement("button",{"aria-label":"Minimize"})),W.a.createElement("button",{"aria-label":"Maximize"}),W.a.createElement(K.b,{to:"/"},W.a.createElement("button",{"aria-label":"Close"}," ")))),W.a.createElement("div",{className:"window-body "})))},V=n(23),Z=n.n(V),$=function(e){var t=e.close,n=e.children;return W.a.createElement("div",{className:"welcome-scrim"},W.a.createElement("div",{id:"welcome"},n,W.a.createElement(K.b,{to:"/",className:"x",onClick:t},W.a.createElement("button",null," x"))))},ee=n(40),te=n.n(ee),ne=n(89),re=n.n(ne),ae=n(90),ie=n.n(ae),oe=(P={},re()(P,r.d.Empty,"🜂"),re()(P,r.d.Rule1,"🝊"),re()(P,r.d.Rule2,"☉"),re()(P,r.d.Rule3,"☽"),re()(P,r.d.Rule4,"🜛"),re()(P,r.d.Rule5,"🜝"),re()(P,r.d.Rule6,"🜏"),P),se=[{key:r.e.Horizontal,symbol:"🜕"},{key:r.e.Quad,symbol:"🜨"}],ce=[{key:r.d.Empty,symbol:oe[r.d.Empty]},{key:r.d.Wild,symbol:"*"},{key:r.d.Rule1,symbol:oe[r.d.Rule1]},{key:r.d.Rule2,symbol:oe[r.d.Rule2]},{key:r.d.Rule3,symbol:oe[r.d.Rule3]},{key:r.d.Rule4,symbol:oe[r.d.Rule4]},{key:r.d.Rule5,symbol:oe[r.d.Rule5]},{key:r.d.Rule6,symbol:oe[r.d.Rule6]}];function ue(e,t){return 3*t+e}var le=function(e){function t(e){return f()(this,t),O()(this,Y()(t).call(this,e))}return F()(t,e),h()(t,[{key:"gridSquare",value:function(e,t,n,a){var i=this,o=this.props,s=o.grid,c=o.options,u=o.selectedElement,l=n&&a,d=s[ue(e,t)];l&&(d=u);var f=c.find((function(e){return e.key==d})).symbol,p=function(n){if(!l){var o=i.props,s=o.grid,c=o.options,u=c.findIndex((function(e){return e.key==d}));u=(u+c.length+n)%c.length,a&&u==c.findIndex((function(e){return e.key===r.d.Wild}))&&(u=(u+c.length+n)%c.length);var f=c[u];s[ue(e,t)]=f.key,(0,i.props.setGrid)(s)}},h="*"===f;return W.a.createElement("div",{key:"".concat(e,"-").concat(t),transform:"translate(".concat(51*e,",").concat(51*t,")"),onContextMenu:function(e){e.preventDefault(),p(-1)},onClick:function(){return p(1)},onDrop:function(n){if(!l){var r=n.dataTransfer.getData("text"),a=parseInt(r,10);if(ce.find((function(e){return e.key==a})))s[ue(e,t)]=a,(0,i.props.setGrid)(s)}},onDragOver:function(e){return e.preventDefault()}},W.a.createElement("button",{className:"mat-box",draggable:"true",style:{width:48,height:48,filter:"saturate(0.8)",color:h?"#666":"black",backgroundColor:h?"#dddddd00":window.pallette[d],borderColor:h?"#aaaaaaaa":window.pallette[d],backgroundImage:'url("assets/paper.png")',backgroundSize:"100px 100px",borderWidth:3,fontSize:"30px",borderStyle:" outset",lineHeight:0,verticalAlign:"middle"},onDragStart:function(e){e.dataTransfer.setData("text/plain",d)}},l||"?"==f?oe[u]:f))}},{key:"render",value:function(){var e=this.props,t=e.isSelector;e.isDisabled;return W.a.createElement("div",{className:ie()({disabled:this.props.isDisabled},"matrix-grid")},[this.gridSquare(0,0,t),this.gridSquare(0,1,t),this.gridSquare(0,2,t),this.gridSquare(1,0,t),this.gridSquare(1,1,t,!0),this.gridSquare(1,2,t),this.gridSquare(2,0,t),this.gridSquare(2,1,t),this.gridSquare(2,2,t)])}}]),t}(W.a.Component),de=[{p:0,symbol:" × "},{p:1,symbol:"   "}],fe=function(e){function t(e){var n;return f()(this,t),(n=O()(this,Y()(t).call(this,e))).state={selectedElement:e.selectedElement,clause_index:e.clause_index,clause:t.getRule(e.selectedElement,e.clause_index),heat:0},window.Editor=Z()(n),console.log("startingInterval"),window.poll=window.setInterval((function(){return n.pollHeat()}),200),n}return F()(t,e),h()(t,[{key:"pollHeat",value:function(){var e=this.props,t=e.selectedElement,n=e.clause_index,r=universe.heatmap(3*t)+universe.heatmap(3*t+1)+universe.heatmap(3*t+2),a=r?universe.heatmap(3*t+n)/r:0;a>0&&(a+=.2),a=Math.floor(25*a)/25,this.setState({heat:a})}},{key:"setRule",value:function(){var e=this.state.clause,t=e.selector,n=e.effector,a=e.symmetry,o=e.probability,s=te()(r.c,i()(t)),c=te()(r.b,i()(n)),u=new r.a(o.p,se[a].key,s,c);window.u.push_undo(),window.u.set_clause(u,this.props.selectedElement,this.props.clause_index)}},{key:"incSymmetry",value:function(e){var t=this.state.clause,n=t.symmetry;t.symmetry=(se.length+n+e)%se.length,this.setState({clause:t},this.setRule)}},{key:"incProbability",value:function(e){var t=this.state.clause,n=t.probability,r=de.indexOf(n);r=(de.length+r+e)%de.length,console.log(de[r]),t.probability=de[r],this.setState({clause:t},this.setRule)}},{key:"render",value:function(){var e=this,t=this.props,n=t.selectedElement,r=(t.clause_index,this.state),a=r.clause,i=r.heat,o=a.selector,s=a.effector,c=a.symmetry,u=a.probability;return W.a.createElement("div",{className:"MatrixMenu"},W.a.createElement("div",{className:"TileGrid"},W.a.createElement("div",{className:"center",style:{fontSize:"30px",opacity:0==u.p?.2:1,gridColumn:2,gridRow:1},onContextMenu:function(t){t.preventDefault(),e.incSymmetry(-1)},onClick:function(){return e.incSymmetry(1)}},se[c].symbol),W.a.createElement("img",{src:"assets/gold_arrow.png",height:"23px",width:"23px",style:{opacity:"×"==u.p?"0.7":"1.0",gridColumn:2,gridRow:2,margin:"auto",filter:"drop-shadow(0px 0px ".concat(10*i,"px gold)")},onContextMenu:function(t){t.preventDefault(),e.incProbability(-1)},onClick:function(){return e.incProbability(1)}}),W.a.createElement("div",{className:"center",style:{fontSize:"45px",color:"#d03f41",gridColumn:2,gridRow:2,overflow:"hidden",willChange:"opacity"},onContextMenu:function(t){t.preventDefault(),e.incProbability(-1)},onClick:function(){return e.incProbability(1)}},u.symbol),o&&W.a.createElement(le,{selectedElement:n,options:ce,grid:o,isSelector:!0,isDisabled:0==u.p,setGrid:function(t){var n=e.state.clause;n.selector=t,e.setState({clause:n},e.setRule)}}),s&&W.a.createElement(le,{selectedElement:n,options:ce,grid:s,isDisabled:0==u.p,setGrid:function(t){var n=e.state.clause;n.effector=t,e.setState({clause:n},e.setRule)}})))}}],[{key:"getRule",value:function(e,t){try{var n=window.u.clause(e,t),r=Array.from(new Uint8Array(memory.buffer,n.selector.grid(),9)).slice(0),a=Array.from(new Uint8Array(memory.buffer,n.effector.grid(),9)).slice(0),i=n.symmetry(),o=n.probability();return{selector:r,effector:a,symmetry:i,probability:de.find((function(e){return e.p==o}))}}catch(e){throw console.error(e),e}}},{key:"getDerivedStateFromProps",value:function(e,n){var r=e.selectedElement,a=e.clause_index;if(r!=n.selectedElement&&r<=6)try{return{selectedElement:r,clause:t.getRule(r,a)}}catch(e){return{selectedElement:r,clause:n.clause}}return null}}]),t}(W.a.Component);function pe(e){for(var t=e.cells(),n=new Uint8Array(o.s.buffer,t,e.width()*e.height()*4),r={},a=0;a<n.length;a+=4)r[n[a]]=(r[n[a]]||0)+1;return r}function he(e,t,n){var a=window.u.clause(t,n),s=[1,2,3,4,5,6];Object.keys(e).forEach((function(t){for(var n=10+Math.pow(e[t],.5),a=0;a<n;a++)s.push(parseInt(t,10)),s.push(r.d.Wild)}));for(var c=s.slice(0),u=s.length,l=0;l<u*(.4+n/3);l++)s.push(r.d.Wild);var d=Array.from(new Uint8Array(o.s.buffer,a.selector.grid(),9)).slice(0),f=Array.from(new Uint8Array(o.s.buffer,a.effector.grid(),9)).slice(0),p=a.symmetry(),h=a.probability();d.forEach((function(e){c.push(e),c.push(e),c.push(e),c.push(e),c.push(e),c.push(e),c.push(e),c.push(e),c.push(e),c.push(e),c.push(e),c.push(e)}));for(var v=Math.floor(3*Math.random()),m=Math.floor(3*Math.random());1==v&&1==m;)v=Math.floor(3*Math.random()),m=Math.floor(3*Math.random());d[ue(v,m)]=s[Math.floor(Math.random()*s.length)],v=Math.floor(3*Math.random()),m=Math.floor(3*Math.random()),d[ue(v,m)]===r.d.Wild&&(v=Math.floor(3*Math.random()),m=Math.floor(3*Math.random())),d[ue(v,m)]===r.d.Wild&&(v=Math.floor(3*Math.random()),m=Math.floor(3*Math.random())),f[ue(v,m)]=c[Math.floor(Math.random()*c.length)],f.forEach((function(e,n){4!=n?d[n]===r.d.Wild&&Math.random()<.1&&(f[n]=r.d.Wild):(f[n]==r.d.Wild||Math.random()<.05)&&(f[n]=t)})),Math.random()>.9&&(p=p==r.e.Quad?r.e.Horizontal:r.e.Quad),Math.random()>.2+.7*h&&(h=1==h?0:1);var y=te()(r.c,i()(d)),x=te()(r.b,i()(f));return new r.a(h,p,y,x)}function ve(e){var t=window.test_universe;window.u.copy_into(t);var n=pe(window.u),r=[he(n,e,0),he(n,e,1),he(n,e,2)];t.set_clause(r[0],e,0),t.set_clause(r[1],e,1),t.set_clause(r[2],e,2);for(var a=0;a<8;a++)t.tick();var i=pe(t);if(!i[e])return console.log("extinct!"),0;if(i[e]/(n[e]+1)<.1)return console.log("decimated!"),0;if(!t.heatmap(3*e+0)&&!t.heatmap(3*e+1)&&!t.heatmap(3*e+2))return console.log("none trigger"),0;for(a=0;a<60;a++)t.tick();var o=pe(t),s=t.width()*t.height()*.95;if(n<s&&o[e]>s)return console.log("overgrown!"),0;for(var c=0;c<3;c++)t.heatmap(3*e+c)&&window.u.set_clause(r[c],e,c);return 1}window.species=r.d;var me=function(){var e=document.createElement("canvas"),t=Object.values(r.d).filter((function(e){return!isNaN(parseFloat(e))})),n=Math.max.apply(Math,i()(t))+1,a=r.f.new(n,1);e.width=n,e.height=3,a.reset(),t.forEach((function(e){return a.paint(e,0,1,e)})),a.paint(r.d.Empty,0,1,r.d.Empty),(0,l({universe:a,canvas:e,isSnapshot:!0}).draw)();var o=e.getContext("webgl"),s=new Uint8Array(4*n);o.readPixels(0,0,n,1,o.RGBA,o.UNSIGNED_BYTE,s);var c={};return t.forEach((function(e){var t=4*e,n="rgba(".concat(s[t],",").concat(s[t+1],", ").concat(s[t+2],", 0.9)");c[e]=n})),c}();window.pallette=me;var ye=Object.keys(r.d).filter((function(e){return e.length>2&&"Wild"!=e})),xe=function(e){function t(e){var n;return f()(this,t),(n=O()(this,Y()(t).call(this,e))).state={submissionMenuOpen:!1,paused:!1,ff:!1,submitting:!1,size:1,dataURL:null,currentSubmission:null,selectedElement:r.d.Rule2},window.UI=Z()(n),n}return F()(t,e),h()(t,[{key:"componentDidUpdate",value:function(e){}},{key:"togglePause",value:function(){window.paused=!this.state.paused,this.setState({paused:!this.state.paused})}},{key:"toggleFF",value:function(){window.ff=!this.state.ff,this.setState({ff:!this.state.ff})}},{key:"play",value:function(){window.paused=!1,this.setState({paused:!1})}},{key:"pause",value:function(){window.paused=!0,this.setState({paused:!0})}},{key:"setSize",value:function(e,t){e.preventDefault(),this.setState({size:t})}},{key:"reset",value:function(){this.play(),Re()}},{key:"closeMenu",value:function(){this.play(),this.setState({dataURL:null})}},{key:"upload",value:function(){console.log("saving");var e=new Uint8Array(o.s.buffer,_e.cells(),Ee*ke*4),t=document.createElement("canvas"),n=t.getContext("2d"),r=n.createImageData(Ee,ke);t.height=ke,t.width=Ee;for(var a=0;a<Ee*ke*4;a++)r.data[a]=a%4==3?255:e[a];n.putImageData(r,0,0);var i=t.toDataURL("image/png");JSON.stringify(i)}},{key:"currentDateString",value:function(){var e=new Date;return"".concat(e.getMonth(),"-").concat(e.getDate())}},{key:"load",value:function(){console.log("loading")}},{key:"refresh",value:function(){var e=this,t=this.state.selectedElement,n=t;this.setState({selectedElement:(t+1)%ye.length},(function(){return e.setState({selectedElement:n})}))}},{key:"render",value:function(){var e=this,t=this.state,n=(t.ff,t.selectedElement),a=t.currentSubmission;t.paused,a&&a.id&&"#".concat(a.id);return W.a.createElement("div",{className:"window fade ",id:"HUD"},W.a.createElement("div",{className:"title-bar"}," ",W.a.createElement("div",{className:"title-bar-text"},"Alchemi Online"),W.a.createElement("div",{className:"title-bar-controls"},W.a.createElement("input",{onChange:function(e){return window.speed=Math.pow(1.2,e.target.value)-1},type:"range",style:{width:80,margin:"3px 10px",filter:"sepia(.2) brightness(.87)"},defaultValue:10,className:"has-box-indicator",min:0,step:5,max:20}),W.a.createElement("button",{onClick:function(){_e.pop_undo(),window.UI.refresh()}},"⤺"),W.a.createElement("button",{onClick:function(){return e.reset()}}," ⏻"))),W.a.createElement("div",{className:"window-body hud-body"},W.a.createElement("div",{id:"hud-buttons",style:{backgroundColor:me[n].replace("0.9","0.2")}},ye.map((function(t){return function(e,t,n){var a=r.d[e],i=me[a],o=a==t,s=e;return oe[a]&&(s=oe[a]),W.a.createElement("button",{className:o?"selected ".concat(e):e,key:e,draggable:!0,onClick:function(){n(a)},onDragStart:function(e){e.dataTransfer.setData("text/plain",a)},onDrop:function(e){var t=e.dataTransfer.getData("text");parseInt(t,10)==a&&n(a)},onDragOver:function(e){return e.preventDefault()},style:{background:"inherit",backgroundColor:i,borderColor:i,filter:o||"saturate(0.8) "}},"  ",s,"  ")}(t,n,(function(t){return e.setState({selectedElement:t})}))})),W.a.createElement("hr",{className:"chain-hr2"}),W.a.createElement(W.a.Fragment,null,W.a.createElement(fe,{selectedElement:n,clause_index:0}),W.a.createElement(fe,{selectedElement:n,clause_index:1}),W.a.createElement(fe,{selectedElement:n,clause_index:2}),W.a.createElement("div",{className:"hint"},"drag and drop tiles to construct rules"),W.a.createElement("button",{onClick:function(){window.u.push_undo();for(var t=0,r=0;r<10&&!((t+=ve(n))>0);r++);console.log(t),e.refresh()},id:"clear-button"}," ","Mutate")),W.a.createElement("hr",{className:"chain-hr2"}),this.state.dataURL&&W.a.createElement($,{close:function(){return e.closeMenu()}},W.a.createElement("img",{src:this.state.dataURL,className:"submissionImg"}),W.a.createElement("div",{style:{display:"flex"}})))))}}]),t}(W.a.Component);function we(){return W.a.createElement(K.a,null,W.a.createElement(Q.a,{path:"/",component:ge}),W.a.createElement(Q.a,{exact:!0,path:"/info/",component:J}))}W.a.Component;var ge=function(e){function t(e){return f()(this,t),O()(this,Y()(t).call(this,e))}return F()(t,e),h()(t,[{key:"render",value:function(){return W.a.createElement(W.a.Fragment,null,W.a.createElement(xe,null))}}]),t}(W.a.Component);n.d(t,"canvas",(function(){return Me})),n.d(t,"width",(function(){return Ee})),n.d(t,"height",(function(){return ke})),n.d(t,"ratio",(function(){return be})),n.d(t,"universe",(function(){return _e})),n.d(t,"reset",(function(){return Re}));var be=4;window.ratio=be;var Ee=100,ke=100;Math.min(Ee,ke);console.log(Ee,ke);var _e=r.f.new(Ee,ke);window.u=_e,window.test_universe=_e.clone(),window.universe=_e,H.a.render(W.a.createElement(we,null),document.getElementById("ui")),T(Ee,ke);var Me=document.getElementById("sand-canvas");Me.width=Ee*be*Math.ceil(window.devicePixelRatio),Me.height=ke*be*Math.ceil(window.devicePixelRatio);var Se=document.getElementById("HUD"),Ce=function(){var e=window.innerWidth,t=(window.innerHeight,""),n="";t="height: ".concat(Math.min(window.innerHeight-80-45,window.innerWidth-481),"px; margin:10px; margin-right: ").concat(401,"px; margin-left:auto;"),n="width: ".concat(361,"px; margin: 10px;"),e<600&&(n="margin: 40px 2px; margin-top:".concat(e+10,"px; margin-bottom: ").concat(45,"px ;padding-bottom: 40px"),t="width:".concat(e-80,"; height: ").concat(e-80,"px; top: 10px; margin:auto; margin-top:10px ; ")),Se.style=n,Me.style=t};Ce(),window.addEventListener("deviceorientation",Ce,!0),window.addEventListener("resize",Ce),window.addEventListener("drop",(function(e){e.preventDefault()}));var De=l({canvas:Me,universe:_e}),ze=performance.now();window.speed=10;function Re(){console.log("reseting"),T(Ee,ke)}!function e(){if(!window.paused)for(var t=0;t<=3;t++){var n=performance.now()-ze,r=1e3/window.speed,a=Math.floor(n/r);if(Math.abs(a)>4&&(ze=performance.now()),!(n>0&&window.speed>0))break;v.render(),_e.tick(),ze+=r}window.t=0,De.draw(),requestAnimationFrame(e)}(),window.UI.load(),document.addEventListener("keydown",(function(e){e.ctrlKey&&"z"===e.key&&(_e.pop_undo(),window.UI.refresh())}))},10:function(e,t,n){"use strict";var r=n.w[e.i];e.exports=r;n(29);r.P()},29:function(e,t,n){"use strict";(function(e){n.d(t,"d",(function(){return f})),n.d(t,"e",(function(){return p})),n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return v})),n.d(t,"c",(function(){return y})),n.d(t,"f",(function(){return x})),n.d(t,"g",(function(){return w})),n.d(t,"h",(function(){return g}));var r=n(10);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}var s=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});s.decode();var c=null;function u(e,t){return s.decode((null!==c&&c.buffer===r.s.buffer||(c=new Uint8Array(r.s.buffer)),c).subarray(e,e+t))}function l(e,t){if(!(e instanceof t))throw new Error("expected instance of ".concat(t.name));return e.ptr}var d,f=Object.freeze({Wild:11,11:"Wild",Empty:0,0:"Empty",Rule1:1,1:"Rule1",Rule2:2,2:"Rule2",Rule3:3,3:"Rule3",Rule4:4,4:"Rule4",Rule5:5,5:"Rule5",Rule6:6,6:"Rule6"}),p=Object.freeze({Horizontal:0,0:"Horizontal",Quad:1,1:"Quad"}),h=function(){function e(t,n,i,o){a(this,e),l(i,y);var s=i.ptr;i.ptr=0,l(o,v);var c=o.ptr;o.ptr=0;var u=r.o(t,n,s,c);return e.__wrap(u)}return o(e,[{key:"free",value:function(){var e=this.ptr;this.ptr=0,r.b(e)}},{key:"probability",get:function(){return r.e(this.ptr)},set:function(e){r.k(this.ptr,e)}},{key:"symmetry",get:function(){return r.g(this.ptr)>>>0},set:function(e){r.m(this.ptr,e)}},{key:"selector",get:function(){var e=r.f(this.ptr);return y.__wrap(e)},set:function(e){l(e,y);var t=e.ptr;e.ptr=0,r.l(this.ptr,t)}},{key:"effector",get:function(){var e=r.d(this.ptr);return v.__wrap(e)},set:function(e){l(e,v);var t=e.ptr;e.ptr=0,r.j(this.ptr,t)}}],[{key:"__wrap",value:function(t){var n=Object.create(e.prototype);return n.ptr=t,n}}]),o(e,[{key:"symmetry",value:function(){return r.g(this.ptr)>>>0}},{key:"probability",value:function(){return r.e(this.ptr)}}],[{key:"new_null",value:function(){var t=r.p();return e.__wrap(t)}}]),e}(),v=function(){function e(t,n,i,o,s,c,u,l,d){a(this,e);var f=r.r(t,n,i,o,s,c,u,l,d);return e.__wrap(f)}return o(e,[{key:"free",value:function(){var e=this.ptr;this.ptr=0,r.c(e)}}],[{key:"__wrap",value:function(t){var n=Object.create(e.prototype);return n.ptr=t,n}}]),o(e,[{key:"grid",value:function(){return r.q(this.ptr)}}]),e}(),m=function(){function e(t,n,i){a(this,e),l(t,h);var o=t.ptr;t.ptr=0,l(n,h);var s=n.ptr;n.ptr=0,l(i,h);var c=i.ptr;i.ptr=0;var u=r.u(o,s,c);return e.__wrap(u)}return o(e,[{key:"free",value:function(){var e=this.ptr;this.ptr=0,r.h(e)}}],[{key:"__wrap",value:function(t){var n=Object.create(e.prototype);return n.ptr=t,n}}]),o(e,[{key:"clause",value:function(e){var t=r.t(this.ptr,e);return h.__wrap(t)}},{key:"set_clause",value:function(e,t){l(e,h),r.v(this.ptr,e.ptr,t)}}]),e}(),y=function(){function e(t,n,i,o,s,c,u,l,d){a(this,e);var f=r.r(t,n,i,o,s,c,u,l,d);return e.__wrap(f)}return o(e,[{key:"free",value:function(){var e=this.ptr;this.ptr=0,r.i(e)}}],[{key:"__wrap",value:function(t){var n=Object.create(e.prototype);return n.ptr=t,n}}]),o(e,[{key:"grid",value:function(){return r.q(this.ptr)}}]),e}(),x=function(){function e(){a(this,e)}return o(e,[{key:"free",value:function(){var e=this.ptr;this.ptr=0,r.n(e)}},{key:"reset",value:function(){r.I(this.ptr)}},{key:"tick",value:function(){r.N(this.ptr)}},{key:"heatmap",value:function(e){return r.B(this.ptr,e)>>>0}},{key:"rule",value:function(e){var t=r.J(this.ptr,e);return m.__wrap(t)}},{key:"clause",value:function(e,t){var n=r.x(this.ptr,e,t);return h.__wrap(n)}},{key:"set_rule",value:function(e,t){l(e,m),r.L(this.ptr,e.ptr,t)}},{key:"set_clause",value:function(e,t,n){l(e,h),r.K(this.ptr,e.ptr,t,n)}},{key:"width",value:function(){return r.O(this.ptr)}},{key:"height",value:function(){return r.C(this.ptr)}},{key:"cells",value:function(){return r.w(this.ptr)}},{key:"paint",value:function(e,t,n,a){r.F(this.ptr,e,t,n,a)}},{key:"push_undo",value:function(){r.H(this.ptr)}},{key:"pop_undo",value:function(){r.G(this.ptr)}},{key:"flush_undos",value:function(){r.A(this.ptr)}},{key:"set_time",value:function(e){r.M(this.ptr,e)}},{key:"inc_time",value:function(){r.D(this.ptr)}},{key:"copy_into",value:function(t){l(t,e),r.z(this.ptr,t.ptr)}},{key:"clone",value:function(){var t=r.y(this.ptr);return e.__wrap(t)}}],[{key:"__wrap",value:function(t){var n=Object.create(e.prototype);return n.ptr=t,n}},{key:"new",value:function(t,n){var a=r.E(t,n);return e.__wrap(a)}}]),e}(),w="function"==typeof Math.random?Math.random:(d="Math.random",function(){throw new Error("".concat(d," is not defined"))}),g=function(e,t){throw new Error(u(e,t))}}).call(this,n(47)(e))},53:function(e,t){},55:function(e,t){},65:function(e,t){e.exports="precision highp float;\n#define GLSLIFY 1\nuniform float t;\nuniform float skyTime;\n\nuniform float dpi;\nuniform vec2 resolution;\nuniform bool isSnapshot;\nuniform sampler2D backBuffer;\nuniform sampler2D dataTexture;\n\nvarying vec2 uv;\nconst float PI2 = 2. * 3.14159265358979323846;\n\n// clang-format off\nvec3 hsv2rgb(vec3 c) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289_0(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289_0(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute_0(vec4 x) {\n     return mod289_0(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise_0(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g_0 = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g_0;\n  vec3 i1 = min( g_0.xyz, l.zxy );\n  vec3 i2 = max( g_0.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289_0(i);\n  vec4 p = permute_0( permute_0( permute_0(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\n//\n// Description : Array and textureless GLSL 2D simplex noise function.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289_1(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289_1(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute_1(vec3 x) {\n  return mod289_1(((x*34.0)+1.0)*x);\n}\n\nfloat snoise_1(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289_1(i); // Avoid truncation effects in permutation\n  vec3 p = permute_1( permute_1( i.y + vec3(0.0, i1.y, 1.0 ))\n    + i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\nhighp float random(vec2 co)\n{\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt= dot(co.xy ,vec2(a,b));\n    highp float sn= mod(dt,3.14);\n    return fract(sin(sn) * c);\n}\n\n// clang-format on\n\nvoid main() {\n  vec2 guv = uv;\n  vec3 color;\n\n  vec2 textCoord = (guv * vec2(0.5, -0.5)) + vec2(0.5);\n\n  vec4 data = texture2D(dataTexture, textCoord);\n  vec4 last = texture2D(backBuffer, vec2(textCoord.x, 1.0 - textCoord.y));\n\n  int type = int((data.r * 255.) + 0.1);\n  float energy = data.g;\n  float age = data.b;\n\n  float hue = 0.0;\n  float saturation =  0.35 + (energy*1.5) + (age *0.2) ;\n  float lightness = 0.7 - energy * .08;\n  float a = 1.0;\n  float brightness = 0.0;\n  float speed = 0.01;\n  // if(type == 4 || type == 5){\n  //   // speed = 0.05;\n  // }\n  vec2 grid =   floor(guv * (resolution / (dpi)));\n  grid.x+=energy*255.;\n  float noise = snoise_0(vec3(grid, t * speed));\n\n  if (type == 0) { // Air\n    hue = 0.7;\n    saturation = 0.0;\n    \n    a = 0.0;\n    lightness = 0.8;\n    if (isSnapshot) {\n      // lightness = 0.9;\n      a = 1.0;\n    }\n  } else if (type == 1) { // wall\n    hue = 0.1;\n    saturation *= 0.3;\n    lightness *= 0.5 ;\n    lightness += noise*0.3;\n     if (isSnapshot) {\n      lightness = 0.2;\n    }\n  } else if (type == 2) { // Sand\n    hue = 0.1;\n    lightness += 0.1;\n  } else if (type == 3) { // plant\n    hue = 0.4;\n    saturation += 0.2;\n    lightness-=0.7*energy;\n  } else if (type == 4) { // water\n    hue = 0.58;\n    // saturation -= 0.05;\n    lightness += 0.1;\n    lightness -= noise * 0.1;\n    // a = 0.9;\n    // if (isSnapshot) {\n    //   a = 1.0;\n    // }\n  } else if (type == 5) { // fire\n    hue = 0.05 + (noise * -0.1);\n    saturation += 0.2;\n\n   lightness += 0.1 + energy * .6;\n\n    //  * (noise + 0.5);\n    if (isSnapshot) {\n      hue += -0.1;\n    }\n\n  } else if (type == 6) { // purple\n    hue = 0.8;\n    lightness += 0.2;\n    hue += energy * 0.2;\n  }\n  if (isSnapshot == false) {\n\n    lightness *= (0.975 + snoise_1(floor(grid)) * 0.15);\n  }\n  saturation = min(saturation, 1.0);\n  lightness = min(lightness, 1.0);\n  color = hsv2rgb(vec3(hue, saturation, lightness));\n\n  gl_FragColor = vec4(color, a);\n}"},66:function(e,t){e.exports='\n// boring "pass-through" vertex shader\nprecision mediump float;\n#define GLSLIFY 1\nattribute vec2 position;\nvarying vec2 uv;\nvoid main() {\n  uv = position;\n  gl_Position = vec4(position, 0, 1);\n}'},71:function(e,t){var n=window.setTimeout((function(){window.UI.state.tutorialProgress>3&&document.body.classList.add("faded")}),3e4),r=function(e){window.clearTimeout(n),document.body.classList.remove("faded"),n=window.setTimeout((function(){window.UI.state.tutorialProgress>3&&document.body.classList.add("faded")}),3e4)};document.body.addEventListener("mousemove",r),document.body.addEventListener("touchstart",r)}}]);
//# sourceMappingURL=2.c421412a287dfbfc16f6.js.map