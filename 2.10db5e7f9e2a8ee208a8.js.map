{"version":3,"sources":["webpack:///./js/render.js","webpack:///./js/fps.js","webpack:///./js/paint.js","webpack:///./js/components/info.js","webpack:///./js/components/menu.js","webpack:///./js/components/matrix.js","webpack:///./js/components/ui.js","webpack:///./js/app.js","webpack:///./js/index.js","webpack:///./crate/pkg/sandtable_bg.js","webpack:///./js/glsl/sand.glsl","webpack:///./js/glsl/sandVertex.glsl","webpack:///./js/setup.js"],"names":["reglBuilder","require","window","memory","fsh","vsh","startWebGL","regl","canvas","universe","isSnapshot","gl","attributes","preserveDrawingBuffer","width","height","cell_pointer","cells","Uint8Array","buffer","dataTexture","texture","data","drawSand","blend","enable","func","srcRGB","srcAlpha","dstRGB","dstAlpha","equation","rgb","alpha","color","frag","uniforms","t","tick","skyTime","resolution","viewportWidth","viewportHeight","dpi","vert","position","count","draw","poll","fps","this","document","getElementById","frames","lastFrameTimeStamp","performance","now","delta","push","length","shift","min","Infinity","max","sum","i","Math","mean","textContent","round","lastPlacedFish","eventDistance","a","b","sqrt","pow","clientX","clientY","norm","mag","magnitude","scale","s","add","sub","painting","lastPaint","repeat","smoothPaint","event","clearInterval","setInterval","paint","startEvent","size","speciesSizes","UI","state","selectedElement","Species","Fish","GoldFish","d","addEventListener","preventDefault","push_undo","body","cancelable","Array","from","touches","handleTouches","paused","forEach","Water","Sand","Empty","Algae","Daphnia","Zoop","Grass","Bacteria","Date","boundingRect","getBoundingClientRect","scaleX","ratio","ceil","devicePixelRatio","scaleY","canvasLeft","left","canvasTop","top","floor","convertEventCoordinates","x","y","Info","className","to","aria-label","Menu","close","children","id","onClick","console","log","SymmetryMode","Slot","OutSlot","SymmetryOptions","key","None","symbol","Horizontal","Vertical","Quad","SlotOptions","Anything","OutSlotOptions","Nop","Me","grid_index","Matrix","props","isCenter","grid","options","myCell","transform","setGrid","style","fill","strokeWidth","fontSize","isSelector","gridSquare","React","Component","Editor","rule","getRule","j_selector","selector","j_effector","effector","j_symmetry","symmetry","Selector","map","v","Effector","r_rule","Rule","u","set_rule","xmlns","viewBox","cx","cy","r","setState","setRule","newGrid","stroke","points","species","pallette_data","createElement","Object","values","filter","k","isNaN","parseFloat","range","Universe","reset","render","ctx","getContext","readPixels","RGBA","UNSIGNED_BYTE","colors","index","pallette","OrganicButton","Index","localStorage","getItem","submissionMenuOpen","ff","submitting","dataURL","currentSubmission","Rule1","setTimeout","prevProps","play","context","imgData","createImageData","putImageData","cellData","toDataURL","dataString","JSON","stringify","setItem","date","getMonth","getDate","parse","upload","img","Image","src","onload","drawImage","getImageData","cellsData","activeSpecies","keys","name","togglePause","n","setElement","elementID","selected","text","background","backgroundColor","borderColor","ElementButton","closeMenu","display","objectFit","AppRouter","path","component","exact","h","drawBowl","ReactDOM","HUD","resize","screen_width","innerWidth","canvasStyle","HUDStyle","innerHeight","hudWidth","parseInt","renderLoop","max_tick_per_frame","requestAnimationFrame","load","cachedTextDecoder","TextDecoder","module","ignoreBOM","fatal","decode","cachegetUint8Memory0","getStringFromWasm0","ptr","len","wasm","subarray","_assertClass","instance","klass","Error","what","freeze","Rule2","Rule3","Full","v1","v2","v3","v4","v5","v6","v7","v8","v9","ret","__wrap","obj","create","prototype","ptr0","ptr1","arg0","__wbg_random_a3b3bcffa2ed629c","random","__wbindgen_throw","arg1","exports","timeout","tutorialProgress","classList","handleActivity","e","clearTimeout","remove"],"mappings":"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","file":"2.10db5e7f9e2a8ee208a8.js","sourcesContent":["const reglBuilder = require(\"regl\");\nconst GIF = require(\"gif.js\");\n// const GIF = require(\"gl-gif\");\nimport { memory } from \"../crate/pkg/sandtable_bg\";\nwindow.memory = memory;\nimport { Species } from \"../crate/pkg/sandtable\";\nimport { Universe } from \"../crate/pkg\";\nimport { finished } from \"stream\";\n\nlet fsh = require(\"./glsl/sand.glsl\");\nlet vsh = require(\"./glsl/sandVertex.glsl\");\n\nlet startWebGL = ({ canvas, universe, isSnapshot = false, gl }) => {\n  let regl;\n  if (gl) {\n    regl = reglBuilder({\n      gl,\n      attributes: { preserveDrawingBuffer: isSnapshot }\n    });\n  } else {\n    regl = reglBuilder({\n      canvas,\n      attributes: { preserveDrawingBuffer: isSnapshot }\n    });\n  }\n  // const lastFrame = regl.texture();\n  const width = universe.width();\n  const height = universe.height();\n  let cell_pointer = universe.cells();\n  let cells = new Uint8Array(memory.buffer, cell_pointer, width * height * 4);\n\n  const dataTexture = regl.texture({ width, height, data: cells });\n\n  let drawSand = regl({\n    blend: {\n      enable: true,\n      func: {\n        srcRGB: \"src alpha\",\n        srcAlpha: 1,\n        dstRGB: \"one minus src alpha\",\n        dstAlpha: 1\n      },\n      equation: {\n        rgb: \"add\",\n        alpha: \"add\"\n      },\n      color: [0, 0, 0, 0]\n    },\n    frag: fsh,\n    uniforms: {\n      t: ({ tick }) => tick,\n      skyTime: () => window.skyTime || 0,\n      dataTexture: () => {\n        cell_pointer = universe.cells();\n        cells = new Uint8Array(memory.buffer, cell_pointer, width * height * 4);\n        return dataTexture({ width, height, data: cells });\n      },\n\n      resolution: ({ viewportWidth, viewportHeight }) => [\n        viewportWidth,\n        viewportHeight\n      ],\n      dpi: 4,\n      isSnapshot\n      // backBuffer: lastFrame\n    },\n\n    vert: vsh,\n    attributes: {\n      // Full screen triangle\n      position: [\n        [-1, 4],\n        [-1, -1],\n        [4, -1]\n      ]\n    },\n    // Our triangle has 3 vertices\n    count: 3\n  });\n\n  return {\n    regl,\n    draw: () => {\n      regl.poll();\n      drawSand();\n    }\n  };\n};\n\nlet snapshot = universe => {\n  let canvas = document.createElement(\"canvas\");\n  canvas.width = universe.width() / 2;\n  canvas.height = universe.height() / 2;\n  let render = startWebGL({ universe, canvas, isSnapshot: true });\n  render();\n\n  return canvas.toDataURL(\"image/png\");\n};\n\nlet exportGif = (universe, cb) => {\n  window.paused = true;\n\n  let canvas = document.createElement(\"canvas\");\n  canvas.width = universe.width() * 2;\n  canvas.height = universe.height() * 2;\n  let w = canvas.width;\n  let h = canvas.height;\n  // let gl = canvas.getContext(\"webgl\");\n\n  var gif = new GIF({\n    workers: 2,\n    quality: 10,\n    width: canvas.width,\n    height: canvas.height,\n    transparent: \"rgba(0,0,0,0)\"\n  });\n  let frames = [];\n\n  const tmpc = document.createElement(\"canvas\");\n  tmpc.width = w;\n  tmpc.height = h;\n  const tctx = tmpc.getContext(\"2d\");\n\n  frames = [];\n  let frameSize = { width: canvas.width, height: canvas.height };\n\n  const numFrames = 20;\n  let t = window.t;\n  for (var i = 0; i < numFrames; i++) {\n    universe.set_time((t / 50) % 255);\n    t += 5;\n    universe.tick();\n    canvas = document.createElement(\"canvas\");\n    canvas.width = universe.width() * 2;\n    canvas.height = universe.height() * 2;\n    let w = canvas.width;\n    let h = canvas.height;\n    let { regl, draw } = startWebGL({ universe, canvas, isSnapshot: false });\n\n    draw();\n    console.log(\"adding frame \" + i);\n    // gif.addFrame(gl, { copy: false });\n\n    // this is faster but the y-axis gets flipped\n    // let data = new ImageData(w, h);\n    // let pixels = new Uint8Array(data.data.buffer);\n    // regl.read(pixels);\n\n    // gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, pixels)\n\n    // var bytes = new Uint8Array(100)\n    // regl.read(bytes)\n\n    tctx.clearRect(0, 0, w, h);\n\n    tctx.drawImage(canvas, 0, 0);\n    const data = tctx.getImageData(0, 0, w, h);\n    frames.push(data);\n\n    // // don't lock up the ui\n    // if (i % 4 == 0) {\n    //     await nextTick()\n    // }\n  }\n  // console.log(frames);\n  //boomerang\n  frames = [...frames, ...frames.slice(0).reverse()];\n  for (const frame of frames) {\n    gif.addFrame(frame, { delay: 16 });\n  }\n\n  gif.on(\"finished\", function(blob) {\n    // window.open(URL.createObjectURL(blob));\n    cb(URL.createObjectURL(blob));\n  });\n  gif.render();\n  // const renderFrame = (n = 0) => {\n  //   console.log(n);\n\n  //   if (n == 20) {\n  //     console.log(\"finished!\");\n  //     gif.on(\"finished\", function(blob) {\n  //       window.open(URL.createObjectURL(blob));\n  //     });\n  //     gif.render();\n  //   } else {\n\n  //     renderFrame(n + 1);\n  //   }\n  // };\n  // renderFrame();\n  window.paused = false;\n};\n\nlet pallette = () => {\n  let canvas = document.createElement(\"canvas\");\n\n  let species = Object.values(Species).filter(k => !isNaN(parseFloat(k)));\n  let range = Math.max(...species) + 1;\n  let universe = Universe.new(range, 1);\n  canvas.width = range;\n  canvas.height = 3;\n  universe.reset();\n\n  species.forEach(id => universe.paint(id, 0, 2, id));\n  universe.paint(species.Empty, 0, 2, species.Empty);\n  let render = startWebGL({ universe, canvas, isSnapshot: true }).draw;\n  render();\n  let ctx = canvas.getContext(\"webgl\");\n  let data = new Uint8Array(range * 4);\n  ctx.readPixels(0, 0, range, 1, ctx.RGBA, ctx.UNSIGNED_BYTE, data);\n  let colors = {};\n  species.forEach(id => {\n    let index = id * 4;\n    let color = `rgba(${data[index]},${data[index + 1]}, ${\n      data[index + 2]\n    }, 1.0)`;\n    colors[id] = color;\n  });\n  return colors;\n};\n\nexport { startWebGL, snapshot, pallette, exportGif };\n","const fps = new (class {\n  constructor() {\n    this.fps = document.getElementById(\"fps\");\n    this.frames = [];\n    this.lastFrameTimeStamp = performance.now();\n  }\n\n  render() {\n    // Convert the delta time since the last frame render into a measure\n    // of frames per second.\n    const now = performance.now();\n    const delta = now - this.lastFrameTimeStamp;\n    this.lastFrameTimeStamp = now;\n    const fps = (1 / delta) * 1000;\n\n    // Save only the latest 100 timings.\n    this.frames.push(fps);\n    if (this.frames.length > 30) {\n      this.frames.shift();\n    }\n\n    // Find the max, min, and mean of our 100 latest timings.\n    let min = Infinity;\n    let max = -Infinity;\n    let sum = 0;\n    for (let i = 0; i < this.frames.length; i++) {\n      sum += this.frames[i];\n      min = Math.min(this.frames[i], min);\n      max = Math.max(this.frames[i], max);\n    }\n    let mean = sum / this.frames.length;\n\n    // Render the statistics.\n    this.fps.textContent = `FPS:${Math.round(mean)}`;\n  }\n})();\n\nexport { fps };\n","import { height, universe, width, ratio } from \"./index.js\";\n\nimport { Species } from \"../crate/pkg\";\n\nconst canvas = document.getElementById(\"sand-canvas\");\nlet lastPlacedFish = 0;\nfunction canPlaceFish() {\n  let diff = Date.now() - lastPlacedFish;\n  if (diff > 1000) {\n    lastPlacedFish = Date.now();\n    return true;\n  } else {\n    return false;\n  }\n}\nconst eventDistance = (a, b) => {\n  return Math.sqrt(\n    Math.pow(a.clientX - b.clientX, 2) + Math.pow(a.clientY - b.clientY, 2),\n    2\n  );\n};\n\nconst magnitude = a => {\n  return Math.sqrt(Math.pow(a.clientX, 2) + Math.pow(a.clientY, 2), 2);\n};\n\nconst norm = a => {\n  let mag = magnitude(a);\n  return { clientX: a.clientX / mag, clientY: a.clientY / mag };\n};\nconst scale = (a, s) => {\n  return { clientX: a.clientX * s, clientY: a.clientY * s };\n};\nconst add = (a, b) => {\n  return { clientX: a.clientX + b.clientX, clientY: a.clientY + b.clientY };\n};\nconst sub = (a, b) => {\n  return { clientX: a.clientX - b.clientX, clientY: a.clientY - b.clientY };\n};\n\nlet painting = false;\nlet lastPaint = null;\nlet repeat = null;\n\ncanvas.addEventListener(\"mousedown\", event => {\n  event.preventDefault();\n\n  universe.push_undo();\n\n  painting = true;\n  clearInterval(repeat);\n  repeat = window.setInterval(() => paint(event), 100);\n  paint(event);\n  lastPaint = event;\n});\n\ndocument.body.addEventListener(\"mouseup\", event => {\n  clearInterval(repeat);\n  if (painting) {\n    event.preventDefault();\n    lastPaint = null;\n    painting = false;\n  }\n});\n\ncanvas.addEventListener(\"mousemove\", event => {\n  clearInterval(repeat);\n  smoothPaint(event);\n});\n\ncanvas.addEventListener(\"mouseleave\", event => {\n  clearInterval(repeat);\n  lastPaint = null;\n});\n\ncanvas.addEventListener(\"touchstart\", event => {\n  if (event.cancelable) {\n    event.preventDefault();\n  }\n  let touches = Array.from(event.touches);\n\n  universe.push_undo();\n\n  painting = true;\n  lastPaint = event;\n  handleTouches(event);\n});\n\ncanvas.addEventListener(\"touchend\", event => {\n  if (event.cancelable) {\n    event.preventDefault();\n  }\n  lastPaint = null;\n  painting = false;\n  clearInterval(repeat);\n});\n\ncanvas.addEventListener(\"touchmove\", event => {\n  if (!window.paused) {\n    if (event.cancelable) {\n      event.preventDefault();\n    }\n  }\n  clearInterval(repeat);\n  handleTouches(event);\n});\n\nfunction smoothPaint(event) {\n  clearInterval(repeat);\n  repeat = window.setInterval(() => paint(event), 100);\n  let startEvent = { clientX: event.clientX, clientY: event.clientY };\n  if (!painting) {\n    return;\n  }\n  let size = speciesSizes[window.UI.state.selectedElement] || 2;\n\n  let i = 0;\n  paint(startEvent);\n  if (\n    lastPaint &&\n    window.UI.state.selectedElement != Species.Fish &&\n    window.UI.state.selectedElement != Species.GoldFish\n  ) {\n    while (eventDistance(startEvent, lastPaint) > size / 3) {\n      let d = eventDistance(startEvent, lastPaint);\n      startEvent = add(\n        startEvent,\n        scale(norm(sub(lastPaint, event)), Math.min(size / 3, d))\n      );\n      i++;\n      if (i > 1000) {\n        break;\n      }\n      paint(startEvent);\n    }\n  }\n  lastPaint = event;\n}\n\nconst handleTouches = event => {\n  let touches = Array.from(event.touches);\n  if (touches.length == 1) {\n    smoothPaint(touches[0]);\n  } else {\n    touches.forEach(paint);\n  }\n};\n\nlet speciesSizes = {\n  [Species.Water]: 13,\n  [Species.Sand]: 8,\n  [Species.Empty]: 7,\n\n  [Species.Algae]: 2,\n  [Species.Fish]: 2,\n  [Species.GoldFish]: 2,\n  [Species.Daphnia]: 2,\n  [Species.Zoop]: 2,\n  [Species.Grass]: 2,\n  [Species.Bacteria]: 2\n};\nfunction convertEventCoordinates(event) {\n  const boundingRect = canvas.getBoundingClientRect();\n\n  const scaleX =\n    canvas.width /\n    (ratio * Math.ceil(window.devicePixelRatio)) /\n    boundingRect.width;\n  const scaleY =\n    canvas.height /\n    (ratio * Math.ceil(window.devicePixelRatio)) /\n    boundingRect.height;\n\n  const canvasLeft = (event.clientX - boundingRect.left) * scaleX;\n  const canvasTop = (event.clientY - boundingRect.top) * scaleY;\n\n  const x = Math.min(Math.floor(canvasLeft), width - 1);\n  const y = Math.min(Math.floor(canvasTop), height - 1);\n  return [x, y];\n}\nconst paint = event => {\n  if (!painting) {\n    return;\n  }\n\n  if (\n    window.UI.state.selectedElement == Species.Fish ||\n    window.UI.state.selectedElement == Species.GoldFish\n  ) {\n    if (!canPlaceFish()) {\n      return;\n    }\n  }\n  const [x, y] = convertEventCoordinates(event);\n  if (window.UI.state.selectedElement < 0) return;\n\n  let size = speciesSizes[window.UI.state.selectedElement] || 3;\n  universe.paint(x, y, size, window.UI.state.selectedElement);\n};\n","import React from \"react\";\n\nimport { Link } from \"react-router-dom\";\n\nconst Info = () => {\n  return (\n    <div className=\"welcome-scrim\">\n      <div className=\"Info window\">\n        <div className=\"title-bar\">\n          <div className=\"title-bar-text\">Information</div>\n          <div className=\"title-bar-controls\">\n            <Link to=\"/\">\n              <button aria-label=\"Minimize\"></button>\n            </Link>\n            <button aria-label=\"Maximize\"></button>\n            <Link to=\"/\">\n              <button aria-label=\"Close\"> </button>\n            </Link>\n          </div>\n        </div>\n        <div className=\"window-body \">\n          {/* <li>A sealed ecosystem simulation </li> */}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Info;\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\n\nconst Menu = ({ close, children }) => {\n  return (\n    <div className=\"welcome-scrim\">\n      <div id={\"welcome\"}>\n        {children}\n        <Link to=\"/\" className=\"x\" onClick={close}>\n          <button> x</button>\n        </Link>\n      </div>\n    </div>\n  );\n};\nexport default Menu;\n","import React from \"react\";\n// import { Rule } from \"../../../crate/pkg/species\";\nimport {\n  Universe,\n  Species,\n  Rule,\n  SymmetryMode,\n  Selector,\n  Effector,\n  Slot,\n  OutSlot\n} from \"../../crate/pkg\";\n// console.log(Species);\nconsole.log(SymmetryMode);\nconsole.log(Slot);\nconsole.log(OutSlot);\n\n// function keys(en) {\n//   return Object.keys(en)\n//     .filter(k => isNaN(parseFloat(k)))\n//     .map(k => {\n//       return { key: k, value: en[k] };\n//     });\n//   // .filter()\n// }\nlet SymmetryOptions = [\n  {\n    key: SymmetryMode.None,\n    symbol: \"‚µî\"\n  },\n  {\n    key: SymmetryMode.Horizontal,\n    symbol: \"üúï\"\n  },\n  {\n    key: SymmetryMode.Vertical,\n    symbol: \"üúî\"\n  },\n  {\n    key: SymmetryMode.Quad,\n    symbol: \"üú®\"\n  }\n];\nlet SlotOptions = [\n  {\n    key: Slot.Empty,\n    symbol: \"√ó\"\n  },\n  {\n    key: Slot.Anything,\n    symbol: \" \"\n  }\n];\n\nlet OutSlotOptions = [\n  {\n    key: OutSlot.Empty,\n    symbol: \"√ó\"\n  },\n  {\n    key: OutSlot.Nop,\n    symbol: \" \"\n  },\n  {\n    key: OutSlot.Me,\n    symbol: \"‚òâ\"\n  }\n];\n\nfunction grid_index(x, y) {\n  return y * 3 + x;\n}\nclass Matrix extends React.Component {\n  constructor(props) {\n    super(props);\n  }\n\n  gridSquare(x, y, isCenter) {\n    let { grid, options } = this.props;\n\n    let myCell = grid[grid_index(x, y)];\n\n    let { symbol } = options[myCell];\n    return (\n      <g\n        key={`${x}-${y}`}\n        transform={`translate(${x * 55 + 15},${y * 55 + 15})`}\n        className={isCenter ? \"disabled\" : \"\"}\n        onClick={() => {\n          if (isCenter) {\n            return;\n          }\n          grid[grid_index(x, y)] = (myCell + 1) % this.props.options.length;\n          let { setGrid } = this.props;\n          setGrid(grid);\n        }}\n      >\n        <rect\n          x={0}\n          y={0}\n          width=\"50\"\n          height=\"50\"\n          className=\"mat-box\"\n          style={{\n            fill: symbol == \" \" ? \"#c0c0c0\" : \"\",\n            strokeWidth: 1\n          }}\n        />\n        <text x={25} y={30} style={{ fontSize: \"30px\" }}>\n          {isCenter ? \"‚òâ\" : symbol}\n        </text>\n      </g>\n    );\n  }\n  render() {\n    // let { data } = this.state;\n    let { isSelector } = this.props;\n    return (\n      <g>\n        {[\n          this.gridSquare(0, 0),\n          this.gridSquare(0, 1),\n          this.gridSquare(0, 2),\n\n          this.gridSquare(1, 0),\n          this.gridSquare(1, 1, isSelector),\n          this.gridSquare(1, 2),\n\n          this.gridSquare(2, 0),\n          this.gridSquare(2, 1),\n          this.gridSquare(2, 2)\n        ]}\n      </g>\n    );\n  }\n}\n\nclass Editor extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      selectedElement: props.selectedElement,\n      rule: Editor.getRule(props.selectedElement)\n    };\n    window.Editor = this;\n  }\n  static getRule(selectedElement) {\n    let rule = window.u.rule(selectedElement);\n\n    const selector = Array.from(\n      new Uint8Array(memory.buffer, rule.selector.grid(), 9)\n    );\n    const effector = Array.from(\n      new Uint8Array(memory.buffer, rule.effector.grid(), 9)\n    );\n    const symmetry = rule.symmetry();\n\n    return {\n      selector,\n      effector,\n      symmetry\n    };\n  }\n  static getDerivedStateFromProps(props, state) {\n    let { selectedElement } = props;\n    if (selectedElement != state.selectedElement && selectedElement < 3) {\n      return {\n        selectedElement,\n        rule: Editor.getRule(selectedElement)\n      };\n    }\n\n    return null;\n  }\n  setRule() {\n    let { rule } = this.state;\n    let {\n      selector: j_selector,\n      effector: j_effector,\n      symmetry: j_symmetry\n    } = rule;\n\n    let selector = new Selector(...j_selector.map(v => SlotOptions[v].key));\n    let effector = new Effector(...j_effector.map(v => OutSlotOptions[v].key));\n    let r_rule = new Rule(SymmetryOptions[j_symmetry].key, selector, effector);\n    window.u.set_rule(r_rule, this.props.selectedElement);\n  }\n  render() {\n    let { rule } = this.state;\n    let { selector, effector, symmetry } = rule;\n\n    return (\n      <div className=\"MatrixMenu\">\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          viewBox=\"-10 0 410 200\"\n          width=\"100%\"\n        >\n          <circle\n            cx={12}\n            cy={94}\n            r=\"16\"\n            className=\"mat-circle\"\n            style={{\n              strokeWidth: 1,\n              fill: \"rgba(255,255,255,0.9)\"\n            }}\n          ></circle>\n\n          <text\n            x=\"12\"\n            y=\"98\"\n            style={{ fontSize: \"30px\" }}\n            onClick={() => {\n              let { rule } = this.state;\n              console.log(symmetry, SymmetryOptions.length);\n              rule.symmetry = (symmetry + 1) % SymmetryOptions.length;\n              console.log(rule.symmetry);\n\n              this.setState(\n                {\n                  rule\n                },\n                this.setRule\n              );\n            }}\n          >\n            {SymmetryOptions[symmetry].symbol}\n          </text>\n          <g transform=\"translate(20,0)\">\n            {selector && (\n              <Matrix\n                options={SlotOptions}\n                grid={selector}\n                isSelector\n                setGrid={newGrid => {\n                  let { rule } = this.state;\n                  rule.selector = newGrid;\n                  this.setState({ rule }, this.setRule);\n                }}\n              />\n            )}\n          </g>\n          <g transform=\"translate(195,80)\">\n            <polygon\n              fill=\"white\"\n              stroke=\"black\"\n              points=\"15,0, 25,15 15,30, 15,20, 8,20, 8,10, 15,10 \"\n            />\n          </g>\n          <g transform=\"translate(210,0)\">\n            {effector && (\n              <Matrix\n                options={OutSlotOptions}\n                grid={effector}\n                setGrid={newGrid => {\n                  let { rule } = this.state;\n                  rule.effector = newGrid;\n                  this.setState({ rule }, this.setRule);\n                }}\n              />\n            )}\n          </g>\n        </svg>\n      </div>\n    );\n  }\n}\n\nexport { Editor };\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\n\nimport { memory } from \"../../crate/pkg/sandtable_bg\";\nimport { Species } from \"../../crate/pkg/sandtable\";\n\nimport { height, universe, width, reset } from \"../index.js\";\nimport { exportGif, pallette } from \"../render.js\";\nimport Menu from \"./menu.js\";\nimport { Matrix, Editor } from \"./matrix\";\n\nwindow.species = Species;\nlet pallette_data = pallette();\nwindow.pallette = pallette_data;\nconst OrganicButton = ({ onClick, className, style, children }) => {\n  return (\n    <button\n      onClick={onClick}\n      className={className}\n      style={{\n        ...style\n      }}\n    >\n      {children}\n    </button>\n  );\n};\nconst ElementButton = (name, selectedElement, setElement) => {\n  let elementID = Species[name];\n\n  let color = pallette_data[elementID];\n\n  let selected = elementID == selectedElement;\n\n  let background = \"inherit\";\n\n  let text = name;\n  if (name == \"Empty\") {\n    text = \"√ó\";\n  }\n\n  if (name == \"Rule1\") {\n    text = \"‚òâ\";\n  }\n\n  if (name == \"Rule2\") {\n    text = \"‚òΩ\";\n  }\n  if (name == \"Rule3\") {\n    text = \"üùÜ\";\n  }\n\n  return (\n    <button\n      className={selected ? `selected ${name}` : name}\n      key={name}\n      onClick={() => {\n        setElement(elementID);\n      }}\n      style={{\n        background,\n        backgroundColor: color,\n        borderColor: color,\n        filter: selected || `saturate(0.4) `\n        // lineHeight: 0\n      }}\n    >\n      {\"  \"}\n      {text}\n      {\"  \"}\n    </button>\n  );\n};\n\nclass Index extends React.Component {\n  constructor(props) {\n    super(props);\n    let tutorialProgress = localStorage.getItem(\"tutorialProgress\") || 0;\n    // tutorialProgress = 0;\n    // console.log(tutorialDone);\n    this.state = {\n      submissionMenuOpen: false,\n      paused: false,\n      ff: false,\n      submitting: false,\n      size: 1,\n      dataURL: null,\n      currentSubmission: null,\n      selectedElement: Species.Rule1\n    };\n    window.UI = this;\n    // this.load();\n    // if (!tutorialDone) {\n    window.setTimeout(() => {\n      // localStorage.setItem(\"tutorialDone\", true);\n      // this.setState({ tutorial: false });\n    }, 1000 * 10);\n    // }\n  }\n\n  componentDidUpdate(prevProps) {}\n  togglePause() {\n    window.paused = !this.state.paused;\n    this.setState({ paused: !this.state.paused });\n  }\n  toggleFF() {\n    window.ff = !this.state.ff;\n    this.setState({ ff: !this.state.ff });\n  }\n  play() {\n    window.paused = false;\n    this.setState({ paused: false });\n  }\n  pause() {\n    window.paused = true;\n    this.setState({ paused: true });\n  }\n\n  setSize(event, size) {\n    event.preventDefault();\n    this.setState({\n      size\n    });\n  }\n  reset() {\n    // if (window.confirm(\"Reset your ecosystem?\")) {\n    this.play();\n    this.setState({ currentSubmission: null });\n\n    reset();\n    // }\n  }\n\n  closeMenu() {\n    this.play();\n    this.setState({ dataURL: null });\n  }\n  upload() {\n    console.log(\"saving\");\n    // let dataURL = snapshot(universe);\n    const cells = new Uint8Array(\n      memory.buffer,\n      universe.cells(),\n      width * height * 4\n    );\n\n    // Create canvas\n    let canvas = document.createElement(\"canvas\"),\n      context = canvas.getContext(\"2d\"),\n      imgData = context.createImageData(width, height);\n\n    canvas.height = height;\n    canvas.width = width;\n\n    // fill imgData with data from cells\n    for (var i = 0; i < width * height * 4; i++) {\n      if (i % 4 == 3) {\n        imgData.data[i] = 255;\n      } else {\n        imgData.data[i] = cells[i];\n      }\n    }\n    // put data to context at (0, 0)\n    context.putImageData(imgData, 0, 0);\n\n    let cellData = canvas.toDataURL(\"image/png\");\n    let dataString = JSON.stringify(cellData);\n    try {\n      localStorage.setItem(\"cell_data\", dataString);\n      localStorage.setItem(\"time\", window.t);\n    } catch {\n      console.log(\"store failed\");\n    }\n\n    try {\n    } catch {\n      console.log(\"store failed\");\n    }\n  }\n  currentDateString() {\n    let date = new Date();\n    return `${date.getMonth()}-${date.getDate()}`;\n  }\n\n  load() {\n    console.log(\"loading\");\n\n    var cellData = JSON.parse(localStorage.getItem(\"cell_data\"));\n\n    if (!cellData) {\n      console.log(\"no save\");\n      window.setInterval(() => this.upload(), 1000 * 10);\n\n      return;\n    }\n\n    var canvas = document.createElement(\"canvas\");\n    canvas.width = width;\n    canvas.height = height;\n    var ctx = canvas.getContext(\"2d\");\n    var img = new Image();\n    img.src = cellData;\n    img.onload = () => {\n      ctx.drawImage(img, 0, 0);\n      var imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\n      const cellsData = new Uint8Array(\n        memory.buffer,\n        universe.cells(),\n        width * height * 4\n      );\n\n      // universe.reset();\n\n      for (var i = 0; i < width * height * 4; i++) {\n        cellsData[i] = imgData.data[i];\n      }\n\n      window.setInterval(() => this.upload(), 1000 * 10);\n    };\n\n    // universe.flush_undos();\n    // universe.push_undo();\n    // this.pause();\n  }\n\n  render() {\n    let { ff, selectedElement, currentSubmission, paused } = this.state;\n    let hash =\n      currentSubmission && currentSubmission.id\n        ? `#${currentSubmission.id}`\n        : \"\";\n\n    let activeSpecies = Object.keys(Species).filter(name => name.length > 2);\n\n    return (\n      <div className=\"window fade ultima\" id=\"HUD\">\n        {/* <div className=\"title-bar\"> */}\n        {/* <div className=\"title-bar-text\">Tile Toy</div> */}\n        {/* <div className=\"title-bar-controls\">\n            <button\n              aria-label=\"Minimize\"\n              onClick={() => {\n                document.body.classList.add(\"faded\");\n              }}\n            ></button>\n            <button aria-label=\"Maximize\"></button>\n            <button\n              aria-label=\"Close\"\n              onClick={() => {\n                document.body.classList.add(\"faded\");\n              }}\n            ></button>\n          </div>\n        </div> */}\n        <div className=\"window-body hud-body\">\n          <div id=\"hud-buttons\">\n            <OrganicButton\n              onClick={() => this.togglePause()}\n              className={paused ? \"selected\" : \"\"}\n            >\n              {paused ? (\n                <svg\n                  className=\"bsvg\"\n                  height=\"20\"\n                  width=\"20\"\n                  id=\"d\"\n                  viewBox=\"-50 -50 400 400\"\n                >\n                  <polygon id=\"play\" points=\"0,0 , 300,150 0,300\" />\n                </svg>\n              ) : (\n                <svg\n                  className=\"bsvg\"\n                  height=\"20\"\n                  width=\"20\"\n                  id=\"d\"\n                  viewBox=\"-50 -50 400 400\"\n                >\n                  <polygon id=\"bar2\" points=\"0,0 110,0 110,300 0,300\" />\n                  <polygon id=\"bar1\" points=\"190,0 300,0 300,300 190,300\" />\n                </svg>\n              )}\n            </OrganicButton>\n            {/* <OrganicButton\n              onClick={() => this.toggleFF()}\n              className={ff ? \"selected\" : \"\"}\n              active={ff}\n            >\n              <svg\n                className=\"bsvg\"\n                height=\"20\"\n                width=\"20\"\n                id=\"d\"\n                viewBox=\"-25 0 350 300\"\n              >\n                <polygon id=\"play\" points=\"0,50 , 150,150 0,250\" />\n                <polygon id=\"play\" points=\"150,50, 300,150 150,250\" />\n              </svg>\n            </OrganicButton> */}\n\n            <OrganicButton onClick={() => this.reset()}>‚Üª</OrganicButton>\n            {/* <Link\n              to={{\n                pathname: \"/info/\",\n                hash\n              }}\n            >\n              <OrganicButton style={{ width: \"calc(100% - 4px)\" }}>\n                Info\n              </OrganicButton>\n            </Link> */}\n\n            {/* <OrganicButton\n              onClick={() => {\n                // reset();\n                universe.pop_undo();\n              }}\n              style={{ fontSize: 18, lineHeight: 0 }}\n            >\n              ‚Üú\n            </OrganicButton> */}\n            {/* \n            <OrganicButton\n              onClick={() => {\n                exportGif(universe, blob => {\n                  this.pause();\n\n                  this.setState({ dataURL: blob });\n                });\n              }}\n            >\n              üì∑\n            </OrganicButton> */}\n\n            {activeSpecies.map(n =>\n              ElementButton(n, selectedElement, id =>\n                this.setState({ selectedElement: id })\n              )\n            )}\n            <img\n              style={{ width: \"100%\" }}\n              src=\"http://community.fortunecity.ws/tinpan/motorhead/13/images/barb_wire.gif\"\n            ></img>\n            <Editor selectedElement={selectedElement}></Editor>\n\n            {this.state.dataURL && (\n              <Menu close={() => this.closeMenu()}>\n                <img src={this.state.dataURL} className=\"submissionImg\" />\n                <div style={{ display: \"flex\" }}></div>\n              </Menu>\n            )}\n            <img\n              style={{ width: \"100%\" }}\n              src=\"http://community.fortunecity.ws/tinpan/motorhead/13/images/barb_wire.gif\"\n            ></img>\n            <img\n              style={{ width: \"27%\", objectFit: \"contain\" }}\n              src=\"https://web.archive.org/web/20091022135502im_/http://geocities.com/witchzcat/bookflip.gif\"\n            ></img>\n            <img\n              style={{ width: \"24%\", objectFit: \"contain\" }}\n              src=\"https://web.archive.org/web/20091027090546/http://geocities.com/traditionalwitchcraft/pentagramanimation.gif\"\n            ></img>\n            <img\n              style={{ width: \"14%\", objectFit: \"contain\" }}\n              src=\"https://web.archive.org/web/20090729083846/http://www.geocities.com/silver_alchemy/torch2.gif\"\n            ></img>\n            <img\n              style={{ width: \"34%\", objectFit: \"contain\" }}\n              src=\"https://web.archive.org/web/20090902061527/http://geocities.com/sunsetstrip/hall/6613/talkskull.gig.gif\"\n            ></img>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport { Index };\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { BrowserRouter as Router, Route, Link } from \"react-router-dom\";\n\nimport Info from \"./components/info\";\nimport { Index } from \"./components/ui\";\nimport Menu from \"./components/menu\";\n\nfunction AppRouter() {\n  return (\n    <Router>\n      <Route path=\"/\" component={Index} />\n      <Route exact path=\"/info/\" component={Info} />\n    </Router>\n  );\n}\n\nfunction startApp() {\n  ReactDOM.render(<AppRouter />, document.getElementById(\"ui\"));\n}\nexport { startApp };\n","import { Universe, Species } from \"../crate/pkg\";\n\nimport { startWebGL } from \"./render\";\nimport { fps } from \"./fps\";\nimport {} from \"./paint\";\nimport {} from \"./setup\";\nimport { startApp } from \"./app\";\n\nlet n = 150;\nlet h = n / 2;\nlet d = n - 6;\nconst universe = Universe.new(n, n);\n\nfunction drawBowl() {\n  universe.paint(h, h, d + 2, Species.Rule1);\n  // universe.paint(h - 30, d - 3, 20, Species.Glass);\n  // universe.paint(h + 30, d - 3, 20, Species.Glass);\n  universe.paint(h, h, d - 2, Species.Empty);\n}\nwindow.u = universe;\nwindow.universe = universe;\n\nstartApp();\ndrawBowl();\n\nlet ratio = 2;\nlet width = n;\nlet height = n;\nconst canvas = document.getElementById(\"sand-canvas\");\n\ncanvas.height = n * ratio * Math.ceil(window.devicePixelRatio);\ncanvas.width = n * ratio * Math.ceil(window.devicePixelRatio);\n\nconst HUD = document.getElementById(\"HUD\");\nlet canvasSize;\nlet resize = () => {\n  let screen_width = window.innerWidth;\n  let HUDheight = 50;\n  let screen_height = window.innerHeight - HUDheight;\n\n  let canvasStyle = \"\";\n  let HUDStyle = \"\";\n\n  if (screen_width - 150 > screen_height) {\n    // if (screen_width - window.innerHeight < 400) {\n    // landscape compressed\n    canvasStyle = `height: ${window.innerHeight}px; margin:3px`;\n    canvasSize = window.innerHeight;\n    let hudWidth = screen_width - window.innerHeight - 12;\n\n    HUDStyle = `width: ${hudWidth}px; margin: 2px;`;\n    // } else {\n    //   // landscape wide\n    //   canvasStyle = `height: ${window.innerHeight}px`;\n    //   canvasSize = window.innerHeight;\n    //   let hudWidth = (screen_width - window.innerHeight) / 2 - 7;\n    //   HUDStyle = `width: ${hudWidth}px; margin: 2px;`;\n    // }\n  } else {\n    //portrait (mobile)\n    canvasSize = screen_width;\n\n    canvasStyle = `width: ${screen_width}px; `;\n  }\n  HUD.style = HUDStyle;\n  canvas.style = canvasStyle;\n};\n\nresize();\nwindow.addEventListener(\"deviceorientation\", resize, true);\nwindow.addEventListener(\"resize\", resize);\n\nlet drawSand = startWebGL({ canvas, universe });\n\nlet t = parseInt(localStorage.getItem(\"time\"), 10) || 0;\nconst renderLoop = () => {\n  const now = performance.now();\n\n  let max_tick_per_frame = window.ff ? 100 : 1;\n  for (var i = 0; i < max_tick_per_frame; i++) {\n    if (!window.paused) {\n      fps.render(); // new\n      universe.tick();\n    }\n    let elapsed_time = performance.now() - now;\n    if (elapsed_time > 16) {\n      break;\n    }\n  }\n  window.t = t;\n  drawSand.draw();\n  requestAnimationFrame(renderLoop);\n};\nfunction reset() {\n  console.log(\"reseting\");\n  localStorage.setItem(\"cell_data\", null);\n  universe.reset();\n  drawBowl();\n}\n\n// window.Editor.setRule();\n\nrenderLoop();\n\nwindow.UI.load();\n\nexport { canvas, width, height, ratio, universe, reset };\n","import * as wasm from './sandtable_bg.wasm';\n\nconst lTextDecoder = typeof TextDecoder === 'undefined' ? (0, module.require)('util').TextDecoder : TextDecoder;\n\nlet cachedTextDecoder = new lTextDecoder('utf-8', { ignoreBOM: true, fatal: true });\n\ncachedTextDecoder.decode();\n\nlet cachegetUint8Memory0 = null;\nfunction getUint8Memory0() {\n    if (cachegetUint8Memory0 === null || cachegetUint8Memory0.buffer !== wasm.memory.buffer) {\n        cachegetUint8Memory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachegetUint8Memory0;\n}\n\nfunction getStringFromWasm0(ptr, len) {\n    return cachedTextDecoder.decode(getUint8Memory0().subarray(ptr, ptr + len));\n}\n\nfunction _assertClass(instance, klass) {\n    if (!(instance instanceof klass)) {\n        throw new Error(`expected instance of ${klass.name}`);\n    }\n    return instance.ptr;\n}\n\nfunction notDefined(what) { return () => { throw new Error(`${what} is not defined`); }; }\n/**\n*/\nexport const Species = Object.freeze({ Empty:10,\"10\":\"Empty\",Rule1:0,\"0\":\"Rule1\",Rule2:1,\"1\":\"Rule2\",Rule3:2,\"2\":\"Rule3\", });\n/**\n*/\nexport const SymmetryMode = Object.freeze({ None:0,\"0\":\"None\",Horizontal:1,\"1\":\"Horizontal\",Vertical:2,\"2\":\"Vertical\",Quad:3,\"3\":\"Quad\", });\n/**\n*/\nexport const Slot = Object.freeze({ Empty:0,\"0\":\"Empty\",Anything:1,\"1\":\"Anything\",Full:2,\"2\":\"Full\", });\n/**\n*/\nexport const OutSlot = Object.freeze({ Empty:0,\"0\":\"Empty\",Nop:1,\"1\":\"Nop\",Me:2,\"2\":\"Me\", });\n/**\n*/\nexport class Cell {\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_cell_free(ptr);\n    }\n}\n/**\n*/\nexport class Effector {\n\n    static __wrap(ptr) {\n        const obj = Object.create(Effector.prototype);\n        obj.ptr = ptr;\n\n        return obj;\n    }\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_effector_free(ptr);\n    }\n    /**\n    * @param {number} v1\n    * @param {number} v2\n    * @param {number} v3\n    * @param {number} v4\n    * @param {number} v5\n    * @param {number} v6\n    * @param {number} v7\n    * @param {number} v8\n    * @param {number} v9\n    */\n    constructor(v1, v2, v3, v4, v5, v6, v7, v8, v9) {\n        var ret = wasm.effector_new(v1, v2, v3, v4, v5, v6, v7, v8, v9);\n        return Effector.__wrap(ret);\n    }\n    /**\n    * @returns {number}\n    */\n    grid() {\n        var ret = wasm.effector_grid(this.ptr);\n        return ret;\n    }\n}\n/**\n*/\nexport class Rule {\n\n    static __wrap(ptr) {\n        const obj = Object.create(Rule.prototype);\n        obj.ptr = ptr;\n\n        return obj;\n    }\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_rule_free(ptr);\n    }\n    /**\n    * @returns {number}\n    */\n    get symmetry() {\n        var ret = wasm.__wbg_get_rule_symmetry(this.ptr);\n        return ret >>> 0;\n    }\n    /**\n    * @param {number} arg0\n    */\n    set symmetry(arg0) {\n        wasm.__wbg_set_rule_symmetry(this.ptr, arg0);\n    }\n    /**\n    * @returns {Selector}\n    */\n    get selector() {\n        var ret = wasm.__wbg_get_rule_selector(this.ptr);\n        return Selector.__wrap(ret);\n    }\n    /**\n    * @param {Selector} arg0\n    */\n    set selector(arg0) {\n        _assertClass(arg0, Selector);\n        var ptr0 = arg0.ptr;\n        arg0.ptr = 0;\n        wasm.__wbg_set_rule_selector(this.ptr, ptr0);\n    }\n    /**\n    * @returns {Effector}\n    */\n    get effector() {\n        var ret = wasm.__wbg_get_rule_effector(this.ptr);\n        return Effector.__wrap(ret);\n    }\n    /**\n    * @param {Effector} arg0\n    */\n    set effector(arg0) {\n        _assertClass(arg0, Effector);\n        var ptr0 = arg0.ptr;\n        arg0.ptr = 0;\n        wasm.__wbg_set_rule_effector(this.ptr, ptr0);\n    }\n    /**\n    * @param {number} symmetry\n    * @param {Selector} selector\n    * @param {Effector} effector\n    */\n    constructor(symmetry, selector, effector) {\n        _assertClass(selector, Selector);\n        var ptr0 = selector.ptr;\n        selector.ptr = 0;\n        _assertClass(effector, Effector);\n        var ptr1 = effector.ptr;\n        effector.ptr = 0;\n        var ret = wasm.rule_new(symmetry, ptr0, ptr1);\n        return Rule.__wrap(ret);\n    }\n    /**\n    * @returns {number}\n    */\n    symmetry() {\n        var ret = wasm.__wbg_get_rule_symmetry(this.ptr);\n        return ret >>> 0;\n    }\n}\n/**\n*/\nexport class Selector {\n\n    static __wrap(ptr) {\n        const obj = Object.create(Selector.prototype);\n        obj.ptr = ptr;\n\n        return obj;\n    }\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_selector_free(ptr);\n    }\n    /**\n    * @param {number} v1\n    * @param {number} v2\n    * @param {number} v3\n    * @param {number} v4\n    * @param {number} v5\n    * @param {number} v6\n    * @param {number} v7\n    * @param {number} v8\n    * @param {number} v9\n    */\n    constructor(v1, v2, v3, v4, v5, v6, v7, v8, v9) {\n        var ret = wasm.effector_new(v1, v2, v3, v4, v5, v6, v7, v8, v9);\n        return Selector.__wrap(ret);\n    }\n    /**\n    * @returns {number}\n    */\n    grid() {\n        var ret = wasm.effector_grid(this.ptr);\n        return ret;\n    }\n}\n/**\n*/\nexport class Universe {\n\n    static __wrap(ptr) {\n        const obj = Object.create(Universe.prototype);\n        obj.ptr = ptr;\n\n        return obj;\n    }\n\n    free() {\n        const ptr = this.ptr;\n        this.ptr = 0;\n\n        wasm.__wbg_universe_free(ptr);\n    }\n    /**\n    */\n    reset() {\n        wasm.universe_reset(this.ptr);\n    }\n    /**\n    */\n    tick() {\n        wasm.universe_tick(this.ptr);\n    }\n    /**\n    * @param {number} i\n    * @returns {Rule}\n    */\n    rule(i) {\n        var ret = wasm.universe_rule(this.ptr, i);\n        return Rule.__wrap(ret);\n    }\n    /**\n    * @param {Rule} rule\n    * @param {number} i\n    */\n    set_rule(rule, i) {\n        _assertClass(rule, Rule);\n        wasm.universe_set_rule(this.ptr, rule.ptr, i);\n    }\n    /**\n    * @returns {number}\n    */\n    width() {\n        var ret = wasm.universe_width(this.ptr);\n        return ret;\n    }\n    /**\n    * @returns {number}\n    */\n    height() {\n        var ret = wasm.universe_height(this.ptr);\n        return ret;\n    }\n    /**\n    * @returns {number}\n    */\n    cells() {\n        var ret = wasm.universe_cells(this.ptr);\n        return ret;\n    }\n    /**\n    * @param {number} x\n    * @param {number} y\n    * @param {number} size\n    * @param {number} species\n    */\n    paint(x, y, size, species) {\n        wasm.universe_paint(this.ptr, x, y, size, species);\n    }\n    /**\n    */\n    push_undo() {\n        wasm.universe_push_undo(this.ptr);\n    }\n    /**\n    */\n    pop_undo() {\n        wasm.universe_pop_undo(this.ptr);\n    }\n    /**\n    */\n    flush_undos() {\n        wasm.universe_flush_undos(this.ptr);\n    }\n    /**\n    * @param {number} t\n    */\n    set_time(t) {\n        wasm.universe_set_time(this.ptr, t);\n    }\n    /**\n    */\n    inc_time() {\n        wasm.universe_inc_time(this.ptr);\n    }\n    /**\n    * @param {number} width\n    * @param {number} height\n    * @returns {Universe}\n    */\n    static new(width, height) {\n        var ret = wasm.universe_new(width, height);\n        return Universe.__wrap(ret);\n    }\n}\n\nexport const __wbg_random_a3b3bcffa2ed629c = typeof Math.random == 'function' ? Math.random : notDefined('Math.random');\n\nexport const __wbindgen_throw = function(arg0, arg1) {\n    throw new Error(getStringFromWasm0(arg0, arg1));\n};\n\n","module.exports = \"precision highp float;\\n#define GLSLIFY 1\\nuniform float t;\\nuniform float skyTime;\\n\\nuniform float dpi;\\nuniform vec2 resolution;\\nuniform bool isSnapshot;\\nuniform sampler2D backBuffer;\\nuniform sampler2D dataTexture;\\n\\nvarying vec2 uv;\\nconst float PI2 = 2. * 3.14159265358979323846;\\n\\n// clang-format off\\nvec3 hsv2rgb(vec3 c) {\\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\\n}\\n\\n//\\n// Description : Array and textureless GLSL 2D/3D/4D simplex\\n//               noise functions.\\n//      Author : Ian McEwan, Ashima Arts.\\n//  Maintainer : ijm\\n//     Lastmod : 20110822 (ijm)\\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\\n//               Distributed under the MIT License. See LICENSE file.\\n//               https://github.com/ashima/webgl-noise\\n//\\n\\nvec3 mod289_0(vec3 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec4 mod289_0(vec4 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec4 permute_0(vec4 x) {\\n     return mod289_0(((x*34.0)+1.0)*x);\\n}\\n\\nvec4 taylorInvSqrt(vec4 r)\\n{\\n  return 1.79284291400159 - 0.85373472095314 * r;\\n}\\n\\nfloat snoise_0(vec3 v)\\n  {\\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\\n\\n// First corner\\n  vec3 i  = floor(v + dot(v, C.yyy) );\\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\\n\\n// Other corners\\n  vec3 g_0 = step(x0.yzx, x0.xyz);\\n  vec3 l = 1.0 - g_0;\\n  vec3 i1 = min( g_0.xyz, l.zxy );\\n  vec3 i2 = max( g_0.xyz, l.zxy );\\n\\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\\n  vec3 x1 = x0 - i1 + C.xxx;\\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\\n\\n// Permutations\\n  i = mod289_0(i);\\n  vec4 p = permute_0( permute_0( permute_0(\\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\\n\\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\\n  float n_ = 0.142857142857; // 1.0/7.0\\n  vec3  ns = n_ * D.wyz - D.xzx;\\n\\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\\n\\n  vec4 x_ = floor(j * ns.z);\\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\\n\\n  vec4 x = x_ *ns.x + ns.yyyy;\\n  vec4 y = y_ *ns.x + ns.yyyy;\\n  vec4 h = 1.0 - abs(x) - abs(y);\\n\\n  vec4 b0 = vec4( x.xy, y.xy );\\n  vec4 b1 = vec4( x.zw, y.zw );\\n\\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\\n  vec4 s0 = floor(b0)*2.0 + 1.0;\\n  vec4 s1 = floor(b1)*2.0 + 1.0;\\n  vec4 sh = -step(h, vec4(0.0));\\n\\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\\n\\n  vec3 p0 = vec3(a0.xy,h.x);\\n  vec3 p1 = vec3(a0.zw,h.y);\\n  vec3 p2 = vec3(a1.xy,h.z);\\n  vec3 p3 = vec3(a1.zw,h.w);\\n\\n//Normalise gradients\\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\\n  p0 *= norm.x;\\n  p1 *= norm.y;\\n  p2 *= norm.z;\\n  p3 *= norm.w;\\n\\n// Mix final noise value\\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\\n  m = m * m;\\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\\n                                dot(p2,x2), dot(p3,x3) ) );\\n  }\\n\\n//\\n// Description : Array and textureless GLSL 2D simplex noise function.\\n//      Author : Ian McEwan, Ashima Arts.\\n//  Maintainer : ijm\\n//     Lastmod : 20110822 (ijm)\\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\\n//               Distributed under the MIT License. See LICENSE file.\\n//               https://github.com/ashima/webgl-noise\\n//\\n\\nvec3 mod289_1(vec3 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec2 mod289_1(vec2 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec3 permute_1(vec3 x) {\\n  return mod289_1(((x*34.0)+1.0)*x);\\n}\\n\\nfloat snoise_1(vec2 v)\\n  {\\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\\n                      0.024390243902439); // 1.0 / 41.0\\n// First corner\\n  vec2 i  = floor(v + dot(v, C.yy) );\\n  vec2 x0 = v -   i + dot(i, C.xx);\\n\\n// Other corners\\n  vec2 i1;\\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\\n  //i1.y = 1.0 - i1.x;\\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\\n  // x1 = x0 - i1 + 1.0 * C.xx ;\\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\\n  vec4 x12 = x0.xyxy + C.xxzz;\\n  x12.xy -= i1;\\n\\n// Permutations\\n  i = mod289_1(i); // Avoid truncation effects in permutation\\n  vec3 p = permute_1( permute_1( i.y + vec3(0.0, i1.y, 1.0 ))\\n    + i.x + vec3(0.0, i1.x, 1.0 ));\\n\\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\\n  m = m*m ;\\n  m = m*m ;\\n\\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\\n\\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\\n  vec3 h = abs(x) - 0.5;\\n  vec3 ox = floor(x + 0.5);\\n  vec3 a0 = x - ox;\\n\\n// Normalise gradients implicitly by scaling m\\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\\n\\n// Compute final noise value at P\\n  vec3 g;\\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\\n  return 130.0 * dot(m, g);\\n}\\n\\nhighp float random(vec2 co)\\n{\\n    highp float a = 12.9898;\\n    highp float b = 78.233;\\n    highp float c = 43758.5453;\\n    highp float dt= dot(co.xy ,vec2(a,b));\\n    highp float sn= mod(dt,3.14);\\n    return fract(sin(sn) * c);\\n}\\n\\n// clang-format on\\n\\nvoid main() {\\n  vec2 guv = uv;\\n  vec3 color;\\n  vec2 grid = floor(guv * (resolution / (dpi * 2.)));\\n\\n  grid = floor(guv * (resolution / dpi));\\n\\n  float noise = snoise_0(vec3(grid, t * 0.05));\\n  vec2 noise_2d = vec2(floor(0.5 + noise),\\n                       floor(0.5 + snoise_0(vec3(grid, (t + 20.) * 0.05))));\\n\\n  vec2 textCoord = (guv * vec2(0.5, -0.5)) + vec2(0.5);\\n  vec2 sampleCoord = textCoord + (noise_2d / (resolution / 2.));\\n\\n  vec4 data = texture2D(dataTexture, textCoord);\\n\\n  int type = int((data.r * 255.) + 0.1);\\n  float energy = data.g;\\n  float age = data.b;\\n\\n  float hue = 0.0;\\n  float saturation = 0.6;\\n  float lightness = 0.3 + energy * 0.5;\\n  float a = 1.0;\\n  float brightness = 0.0;\\n\\n  if (type == 10) { // Air\\n\\n    hue = 0.0;\\n    saturation = 0.1;\\n    lightness = 0.1;\\n    a = 0.0;\\n    if (isSnapshot) {\\n      saturation = 0.05;\\n      lightness = 1.01;\\n      a = 1.0;\\n    }\\n\\n  } else if (type == 11) { // Glass\\n    hue = 0.1;\\n    saturation = 0.2;\\n    lightness = 1.0;\\n  } else if (type == 2) { // Sand\\n    hue = 0.1;\\n    saturation = 0.4 + (age * 0.3);\\n    lightness = 1.0 - energy * 0.5;\\n\\n  } else if (type == 1) { // Water\\n    hue = 0.58;\\n    saturation = 0.6;\\n    lightness = 0.5 + energy * 0.25 + noise * 0.1;\\n    a = 0.4;\\n    if (isSnapshot) {\\n      a = 1.0;\\n    }\\n  } else if (type == 0) { // Plant\\n    hue = 0.4;\\n    saturation = 0.4;\\n\\n  } else if (type == 6) { // Zoop\\n    hue = 0.9;\\n    lightness += 0.7;\\n  } else if (type == 7) { // Fish\\n    hue = 0.0;\\n    lightness += 0.4;\\n  } else if (type == 8) { // Bacteria\\n    hue = 0.66;\\n    saturation += 0.2;\\n    lightness += 0.2;\\n    a = 0.4;\\n    if (isSnapshot) {\\n      // lightness += 0.8;\\n      saturation -= 0.2;\\n\\n      a = 1.0;\\n    }\\n  } else if (type == 9) { // ???\\n    hue = 0.6;\\n    saturation = 0.4;\\n    lightness = 0.7 + data.g * 0.5;\\n  } else if (type == 10) { // Waste\\n    hue = 0.9;\\n    lightness -= 0.2;\\n    saturation = 0.4;\\n    a = 0.8;\\n  } else if (type == 11) { // Grass\\n    hue = 0.4;\\n    saturation = 0.4;\\n  } else if (type == 12) { // Stone\\n    hue = -0.4 + (data.g * 0.5);\\n    saturation = 0.1;\\n  } else if (type == 13) { // Wood\\n    hue = (data.g * 0.1);\\n    saturation = 0.3;\\n    lightness = 0.3 + data.g * 0.3;\\n  } else if (type == 14) { // Egg\\n    hue = 0.9;\\n    saturation = age / 3.;\\n    lightness = 1.0;\\n    a = 0.8;\\n  } else if (type == 15) { // Tail\\n    hue += fract(age * 1.9 * 255. / 8.) * 0.2;\\n    lightness += 0.4;\\n    saturation -= (fract(age * 1.9 * 255. / 8.) - 0.1) * 0.7;\\n\\n    // saturation += fract(age * 255.*6.);\\n  } else if (type == 16) { // bubble\\n\\n    hue = 0.0;\\n    saturation = 0.1;\\n    lightness = 0.1;\\n    a = 0.0;\\n    if (isSnapshot) {\\n      saturation = 0.05;\\n      lightness = 1.01;\\n      a = 1.0;\\n    }\\n  } else if (type == 17) { // biofilm\\n    hue = 0.48;\\n    saturation = 0.6;\\n    lightness = 0.5 + energy * 0.25 + noise * 0.1;\\n    a = 0.4;\\n    if (isSnapshot) {\\n      a = 1.0;\\n    }\\n  } else if (type == 18) { // goldfish\\n    hue = 0.1;\\n    lightness += 0.3;\\n    saturation = 0.9;\\n  } else if (type == 19) { // goldfishtail\\n    hue = 0.1;\\n    hue += fract(age * 1.9 * 255. / 9.) * 0.1;\\n    lightness += 0.6;\\n    saturation = 0.9;\\n    saturation -= (fract(age * 1.9 * 255. / 7.) - 0.1) * 0.6;\\n  } else if (type == 20) { // plastic\\n    hue = 0.1;\\n    lightness += 0.5;\\n    saturation = 0.1;\\n  }\\n  lightness *= 0.85 + cos(skyTime * PI2) * 0.2;\\n\\n  if (isSnapshot == false) {\\n    lightness *= (0.975 + snoise_1(floor(guv * resolution / dpi)) * 0.025);\\n  }\\n  saturation = min(saturation, 1.0);\\n  lightness = min(lightness, 1.0);\\n  color = hsv2rgb(vec3(hue, saturation, lightness));\\n\\n  gl_FragColor = vec4(color, a);\\n  // gl_FragColor = getColor(uv);\\n}\"","module.exports = \"\\n// boring \\\"pass-through\\\" vertex shader\\nprecision mediump float;\\n#define GLSLIFY 1\\nattribute vec2 position;\\nvarying vec2 uv;\\nvoid main() {\\n  uv = position;\\n  gl_Position = vec4(position, 0, 1);\\n}\"","// if (window.safari) {\n//   history.pushState(null, null, location.href);\n//   window.onpopstate = function(event) {\n//     history.go(1);\n//   };\n// }\n\nlet background = document.getElementById(\"background\");\nlet fadeTimout = 1000 * 30;\nlet timeout = window.setTimeout(() => {\n  if (window.UI.state.tutorialProgress > 3) {\n    document.body.classList.add(\"faded\");\n  }\n}, fadeTimout);\n\nlet handleActivity = e => {\n  window.clearTimeout(timeout);\n  document.body.classList.remove(\"faded\");\n  timeout = window.setTimeout(() => {\n    if (window.UI.state.tutorialProgress > 3) {\n      document.body.classList.add(\"faded\");\n    }\n  }, fadeTimout);\n};\ndocument.body.addEventListener(\"mousemove\", handleActivity);\ndocument.body.addEventListener(\"touchstart\", handleActivity);\n\nbackground.addEventListener(\"touchmove\", e => {\n  if (!window.paused) {\n    if (e.cancelable) {\n      e.preventDefault();\n    }\n  }\n});\n\n// if (\"serviceWorker\" in navigator) {\n//   window.addEventListener(\"load\", () => {\n//     navigator.serviceWorker\n//       .register(\"/service-worker.js\")\n//       .then(registration => {\n//         console.log(\"SW registered: \", registration);\n//       })\n//       .catch(registrationError => {\n//         console.log(\"SW registration failed: \", registrationError);\n//       });\n//   });\n// }\n"],"sourceRoot":""}